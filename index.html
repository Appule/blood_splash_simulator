<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®šãƒšãƒ¼ã‚¸</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .object-box {
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 10px;
      background: #f9f9f9;
    }

    label {
      display: block;
      margin-bottom: 4px;
    }

    input[type="number"] {
      width: 80px;
      margin-left: 4px;
    }

    h4 {
      margin-top: 10px;
      margin-bottom: 4px;
      font-size: 1em;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <h2>ğŸŒ ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š</h2>
  <div id="paramContainer"></div>
  <h3>ğŸ›  æ“ä½œ</h3>
  <button onclick="startSimulation()">â–¶ ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹</button>
  <button onclick="saveToFile()">ğŸ’¾ è¨­å®šã‚’ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜</button>
  <input type="file" id="fileInput" accept=".json" onchange="loadFromFile()" />
  <br>

  <script>
    const globalParamDefs = [
      {
        section: "æµä½“é–¢ä¿‚ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿",
        params: [
          { id: 'dt', label: 'æ™‚é–“ã‚¹ãƒ†ãƒƒãƒ—', value: 0.01, step: 0.001 },
          { id: 'gravityX', label: 'é‡åŠ›x', value: 0.0, step: 1.0 },
          { id: 'gravityY', label: 'é‡åŠ›y', value: 0.0, step: 1.0 },
          { id: 'h', label: 'å½±éŸ¿åŠå¾„', value: 5.0, step: 0.1 },
          { id: 'mass', label: 'è³ªé‡', value: 0.5, step: 0.1 },
          { id: 'rho0', label: 'åŸºæº–å¯†åº¦', value: 1.0, step: 0.1 },
          { id: 'B', label: 'åœ§åŠ›å®šæ•°', value: 10000, step: 100 },
          { id: 'nB', label: 'è¿‘åœ§åŠ›å®šæ•°', value: 5, step: 0.1 },
          { id: 'viscosity', label: 'ç²˜æ€§', value: 0.0, step: 0.1 },
          { id: 'alpha', label: 'è¡¨é¢å¼µåŠ›', value: 0.2, step: 0.1 },
          { id: 'scale', label: 'ã‚¹ã‚±ãƒ¼ãƒ«', value: 1.0, step: 0.1 },
        ]
      },
      {
        section: "è‰²æç”»ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿",
        params: [
          { id: 'colDecay', label: 'è‰²æ¸›è¡°', value: 40.0, step: 1 },
          { id: 'colDiffuse', label: 'è‰²æ‹¡æ•£', value: 0.8, step: 0.1 },
          { id: 'TOON_THRESHOLD', label: 'è‰²é–¾å€¤', value: 0.6, step: 0.01 },
        ]
      },
      {
        section: "è³ªé‡å¤‰åŒ–ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿",
        params: [
          { id: 'massGrowTime', label: 'è³ªé‡æˆé•·æ™‚é–“', value: 0.8, step: 0.1 },
          { id: 'massGrowSlope', label: 'è³ªé‡æˆé•·é€Ÿåº¦', value: 1.0, step: 0.1 },
          { id: 'massDecay', label: 'è³ªé‡æ¸›è¡°', value: 1.4, step: 0.1 },
          { id: 'massCutoff', label: 'è³ªé‡ã‚«ãƒƒãƒˆã‚ªãƒ•', value: 0.01, step: 0.01 },
        ]
      },
      {
        section: "é€Ÿåº¦å¤‰åŒ–ï¼ˆç›´ç·šï¼‰ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿",
        params: [
          { id: 'velDecay', label: 'é€Ÿåº¦æ¸›è¡°', value: 0.2, step: 0.1 },
          { id: 'partMinVel', label: 'æœ€å°é€Ÿåº¦', value: 10, step: 1 },
          { id: 'lastInitVel', label: 'æœ€çµ‚ã‚¹ãƒãƒ¼ãƒ³é€Ÿåº¦', value: 0.8, step: 0.1 },
          { id: 'flowOutVelStr', label: 'å¤–å‘ãæµã‚Œã®å¼·ã•', value: 0.5, step: 0.01 },
          { id: 'flowStCont', label: 'å…ˆç«¯ã«ã‹ã‹ã‚‹ä¿‚æ•°', value: 0.1, step: 0.01 },
          { id: 'flowVelMean', label: 'ã‚¹ãƒˆãƒªãƒ¼ãƒ åˆé€Ÿå¹³å‡', value: 200, step: 10 },
          { id: 'flowVelRnd', label: 'ã‚¹ãƒˆãƒªãƒ¼ãƒ åˆé€Ÿã°ã‚‰ã¤ã', value: 150, step: 10 },
        ]
      },
      {
        section: "é€Ÿåº¦å¤‰åŒ–ï¼ˆå›è»¢ï¼‰ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿",
        params: [
          { id: 'crossFactor', label: 'å›è»¢é€Ÿåº¦', value: 0.01, step: 0.01 },
          { id: 'crossTime', label: 'å›è»¢æ™‚é–“', value: 0.6, step: 0.1 },
          { id: 'flowYMaxMean', label: 'ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚«ãƒ¼ãƒ–ä½ç½®å¹³å‡', value: 0.2, step: 0.01 },
          { id: 'flowYMaxRnd', label: 'ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚«ãƒ¼ãƒ–ä½ç½®ã°ã‚‰ã¤ã', value: 0.2, step: 0.01 },
        ]
      },
      {
        section: "ã‚¹ãƒãƒ¼ãƒ³ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿",
        params: [
          { id: 'sPosX', label: 'ã‚¹ãƒãƒ¼ãƒ³åº§æ¨™x', value: 0.5, step: 0.01 },
          { id: 'sPosY', label: 'ã‚¹ãƒãƒ¼ãƒ³åº§æ¨™y', value: 0.5, step: 0.01 },
          { id: 'sPosA', label: 'ã‚¹ãƒãƒ¼ãƒ³åº§æ¨™å„ã‚¹ãƒˆãƒªãƒ¼ãƒ ã®ãšã‚Œ', value: 0.2, step: 0.1 },
          { id: 'spawnFineAdjustN', label: 'æ°´å¹³æ–¹å‘ã®ç²’å­é–“è·é›¢ã®è£œæ­£', value: 0.05, step: 0.01 },
          { id: 'spawnFineAdjustV', label: 'å‚ç›´æ–¹å‘ã®ç²’å­é–“è·é›¢ã®è£œæ­£', value: 1.2, step: 0.01 },
        ]
      },
      {
        section: "ã‚¹ãƒˆãƒªãƒ¼ãƒ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿",
        params: [
          { id: 'flowNum', label: 'ã‚¹ãƒˆãƒªãƒ¼ãƒ æ•°', value: 40, step: 1 },
          { id: 'flowTimeMean', label: 'ã‚¹ãƒˆãƒªãƒ¼ãƒ é•·ã•å¹³å‡', value: 0.12, step: 0.01 },
          { id: 'flowTimeRnd', label: 'ã‚¹ãƒˆãƒªãƒ¼ãƒ é•·ã•ã°ã‚‰ã¤ã', value: 0.04, step: 0.01 },
          { id: 'flowThMean', label: 'ã‚¹ãƒˆãƒªãƒ¼ãƒ è§’åº¦å¹³å‡', value: 0.0, step: 0.01 },
          { id: 'flowThRnd', label: 'ã‚¹ãƒˆãƒªãƒ¼ãƒ è§’åº¦ã°ã‚‰ã¤ã', value: 0.4, step: 0.01 },
          { id: 'flowBold', label: 'ã‚¹ãƒˆãƒªãƒ¼ãƒ å¤ªã•', value: 3.2, step: 0.1 },
          { id: 'noiseLevel', label: 'ãƒã‚¤ã‚ºãƒ¬ãƒ™ãƒ«', value: 0.2, step: 0.01 },
          { id: 'noiseFreq', label: 'ãƒã‚¤ã‚ºå‘¨æ³¢æ•°', value: 2000, step: 10 },
        ]
      },
      {
        section: "ç”»è§’ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿",
        params: [
          { id: 'phi', label: 'ç”»é¢å…¨ä½“ã®å‚¾ã', value: 0, step: 0.01 },
          { id: 'th', label: 'ç”»é¢å…¨ä½“ã®å›è»¢', value: 0, step: 0.01 },
          { id: 'thRange', label: 'å„ã‚¹ãƒˆãƒªãƒ¼ãƒ ã®å‚¾ãã°ã‚‰ã¤ã', value: 2.6, step: 0.1 },
        ]
      }
    ];


    function createParamInputs() {
      const container = document.getElementById('paramContainer');

      globalParamDefs.forEach(group => {
        const sectionLabel = document.createElement('h4');
        sectionLabel.textContent = `ãƒ»${group.section}`;
        container.appendChild(sectionLabel);

        group.params.forEach(param => {
          const label = document.createElement('label');
          label.innerHTML = `${param.label} (${param.id}): `;

          const input = document.createElement('input');
          input.type = 'number';
          input.id = `global-${param.id}`;
          input.value = param.value;
          input.step = param.step;

          label.appendChild(input);
          container.appendChild(label);
        });

        container.appendChild(document.createElement('br'));
      });
    }

    function getGlobalParams() {
      const result = {};
      globalParamDefs.forEach(group => {
        group.params.forEach(param => {
          result[param.id] = Number(document.getElementById(`global-${param.id}`).value);
        });
      });
      return result;
    }

    function setGlobalParams(params) {
      globalParamDefs.forEach(group => {
        group.params.forEach(param => {
          const el = document.getElementById(`global-${param.id}`);
          if (el) el.value = params[param.id] ?? param.value;
        });
      });
    }
    
    window.onload = () => {
      createParamInputs();
    };

    function startSimulation() {
      const globalParams = getGlobalParams();
      const fullData = { global: globalParams };
      localStorage.setItem('simulationParams', JSON.stringify(fullData));
      window.location.href = 'simulation.html';
    }

    function saveToFile() {
      const globalParams = getGlobalParams();
      const fullData = { global: globalParams };

      const blob = new Blob([JSON.stringify(fullData, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);

      const a = document.createElement('a');
      a.href = url;
      a.download = 'simulation_config.json';
      a.click();

      URL.revokeObjectURL(url);
    }

    function loadFromFile() {
      const fileInput = document.getElementById('fileInput');
      const file = fileInput.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);
          setGlobalParams(data.global || {});
        } catch (err) {
          alert('èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ' + err.message);
        }
      };
      reader.readAsText(file);
    }
  </script>

</body>
</html>